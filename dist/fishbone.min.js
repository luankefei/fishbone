"use strict";!function(e,t){function n(e){return n.fn.init(e)}function o(e,t){var n,o=[].slice.call(arguments),r=1,s="boolean"==typeof o[o.length-1]?o.pop():!0;for(1===o.length&&(e=this.window?{}:this,r=0);t=o[r++];)for(n in t)!Object.prototype.hasOwnProperty.call(t,n)||!s&&n in e||(e[n]=t[n]);return e}var r=t.dispatchEvent,s=(t.documentElement,t.head||t.getElementsByTagName("head"),1);n.fn=n.prototype,o(n.fn,{mix:o,nodes:[],fishbone:s,constructor:n,length:0,init:function(e){if(e.nodeName)this.nodes=e,this.selector=null;else{this.selector=e;var o=e.split(" ");1===o.length&&"#"===o[0].charAt(0)?this.nodes=t.querySelector(o[0]):(this.nodes=t.querySelectorAll(e),this.nodes=Array.prototype.slice.call(this.nodes))}var r=Object.create(n.fn);return r.nodes=this.nodes,r.selector=this.selector,r}}),String.prototype.byteLen=function(e,t){t=t?t:2;var n=new Array(t+1).join("-");return e.replace(/[^\x00-\xff]/g,n).length},Array.prototype.random=function(e){return e[Math.floor(Math.random()*e.length)]},Array.prototype.flatten=function(e){var t=[];e.forEach(function(e){return Array.isArray[e]?t=t.concat(Array.prototype.flatten(e)):t.push(e),t})},Array.prototype.min=function(e){return Math.min.apply(0,e)},Array.prototype.max=function(e){return Math.max.apply(0,e)},Array.prototype.unique=function(){this.sort();for(var e=["1"],t=1;t<this.length;t++)this[t]!==e[e.length-1]&&e.push(this[t]);return e.shift(),e},Array.prototype.union=function(e,t){return e.concat(t).unique()},Array.prototype.first=function(){return this[0]},Array.prototype.last=function(){return this[this.length-1]};var i={},a={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0};i.getScript=function(e,t){seajs.use(e,t)},i.getCss=function(e,t){var n=document.createElement("link"),o=document.getElementsByTagName("head")[0];n.href=e,n.rel="stylesheet",n.onload=t.call(this),o.appendChild(n)},i.get=function(e,t){var n=a;n.url=e,i.ajax(n,t)},i.ajax=function(e,t,n){var o=e.url,r=e.type?e.type.toUpperCase():a.type,s=e.data||null,i=new XMLHttpRequest;if(i.open(r,o),"undefined"!=typeof n)for(var l in n)i["on"+l]=n[l];i.onreadystatechange=function(){if(200===i.status&&4===i.readyState){var e=i.responseText;t&&t(e)}},i.setRequestHeader("Content-type",a.contentType),i.send(s)},i.jsonp=function(e,t,n,o){var r=document.createElement("script"),s=document.querySelector("body");r.src=e+"?type=jsonp&callbackName="+n,r.id="jsonp",r.onload=o,window[n]=t.funcName,s.appendChild(r)},i.comet=function(){},i.socket=function(){};var l={};l.append=function(e){return 1===this.nodes.length?this.nodes.appendChild(e):this.nodes.forEach(function(t){var n=e.cloneNode(!0);t.appendChild(n)}),this},l.prepend=function(e){return this.nodes.nodeName?this.nodes.insertBefore(e,this.nodes.childNodes[0]):this.nodes.forEach(function(t){var n=e.cloneNode(!0);t.insertBefore(n,t.childNodes[0])}),this},l.clone=function(e){if(this.nodes.nodeName)return this.nodes.cloneNode(e);var t=[];return this.nodes.forEach(function(n){t.push(n.cloneNode(e))}),t},l.html=function(e){var t=this.nodes;return void 0!==e?(t.nodeName?t.innerHTML=e:t.forEach(function(t,n,o){t.innerHTML=e}),this):t.nodeName?t.innerHTML:""},l.remove=function(){var e=this.nodes;if(e instanceof Array)for(var t=0,n=e.length;n>t;t++){var o=e[t];o.parentNode.removeChild(o)}else e.parentNode.removeChild(e);return null},l.empty=function(){},l.after=function(){},l.before=function(){},l.css=function(){},l.width=function(){},l.attr=function(e,t){},l.eq=function(e){var t=null;try{t=this.nodes[e],t=n.fn.init(t)}catch(o){console.error("$.fn.eq只能用于复数节点集合")}return t},l.first=function(){return l.eq.call(this,0)},l.last=function(){return l.eq.call(this,this.nodes.length-1)};var c={};c.cssReady=!1,c.jsReady=!1,c.hash=null,c.getHash=function(){var e=window.location.hash,t=window.history;return e=e.replace("#!",""),c.hash=e,t.replaceState(null,null,e),console.log("hash"),console.log(e),console.log(e.length),console.log(encodeURI(e)),console.log(""==e||"/"==e||"index"==e||" "==e),e},c.load=function(e){c.resetResource(),c.loadCss(e.css)},c.resetResource=function(){for(var e=n("link, script"),t=0;t<e.nodes.length;t++){var o=e.eq(t).attr("data-type");"common"!==o&&e.eq(t).remove()}},c.resetStatus=function(){c.cssReady=!1,c.jsReady=!1,c.hash=null},Object.defineProperties(c,{cssReady:{enumerable:!0,configurable:!0,get:function(){return this.value},set:function(e){this.value=e,e===!0&&(c.loadJs(c.routes[c.hash].js),c.loadTempalte(c.routes[c.hash].template))}}}),c.loadTempalte=function(e){i.get(e,function(e){n("#fs-view").html(e)})},c.loadJs=function(e){for(var t=0,n=function(){t+=1,t===e.length&&(c.jsReady=!0)},o=0;o<e.length;o++)i.getScript(e[o],n)},c.loadCss=function(e){for(var t=0,n=function(){t+=1,t===e.length&&(c.cssReady=!0)},o=0;o<e.length;o++)i.getCss(e[o],n)},c.provider=function(e){var t=this,n={},o=function(){console.log("hashChange 的加载");var e=c.getHash(),t=c.routes[e];c.load(t)};return this.when=function(e,o){return e instanceof Array?e.forEach(function(e,t,r){n[e]=o}):n[e]=o,t},this.otherwise=function(e){n.otherwise=e,c.routes=n,window.addEventListener("hashchange",o),c.resetStatus(),!function(){console.log("! function 的加载");var e=c.getHash();console.log("! function 的 hash"),console.log(e),console.log(c.routes);var t=c.routes[e];console.log("! function 的 routes"),console.log(t),c.load(t)}()},this};var u={};u.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,function(t){return n.call(e,t)})},u.removeEvent=function(e,t,n){void 0===n&&(e["on"+t]=null),e.removeEventListener?e.removeEventListener(t,n,!1):e.detechEvent("on"+t,n)},u.live=function(e,t){var n=this.selector;document.addEventListener(e,function(e){for(var o=document.querySelectorAll(n),r=0;r<o.length;r++)if(o[r]===e.target)return t.call(e.target,e)})},u.on=function(e,t){var n=this.nodes;n.nodeName?u.addEvent(n,e,t):n.forEach(function(n,o,r){u.addEvent(n,e,t)})},u.ready=function(e){var n=r?"DOMContentLoaded":"readystatechange",o=null;this.nodes===document&&("readystatechange"===n?o=function(){"complete"===t.readyState&&Function.call(e)}:u.addEvent(this.nodes,n,o,!1))},u.unbind=function(){};var h={};h.Component=function(){return this.node=null,this.view=null,this.controller=null,this.model=null,this.init=function(e){return this.node=e,this.model.init.call(this,function(){}),this},this},h.component={},h.component.init=function(e,t){var n=new h.Component;return n=Object.defineProperties(n,{data:{enumerable:!0,configurable:!0,get:function(){return this.value},set:function(e){this.value=e,this.controller.refresh(this.node)}}}),t.call(this,n)};var d={};d.validateChange=function(e){return"+"===e[0]||"-"===e[0]},d.handleSeperator=function(e){var t=e.indexOf("-");return-1!==t&&(e=e.replace("-",""),e=e.substring(0,t)+e[t].toUpperCase()+e.substring(t+1)),e},d.calculateChange=function(e,t){var n=d.getCss.call(this,e);return n=Number.parseInt(n.substring(0,n.length-2)),t=Number.parseInt(t.substring(0,t.length-2)),t=n+t+"px"},d.setCss=function(e,t){var n=d.validateChange(t);if(n&&(t=d.calculateChange.apply(this,[e,t])),e=d.handleSeperator(e),void 0!==this.nodes.nodeName)this.nodes.style[e]=t;else for(var o=0,r=this.nodes.length;r>o;o++)this.nodes[o].style[e]=t;return this},d.getCss=function(t){var n=null,o=this.nodes;return o.nodeName||(o=this.nodes[0]),n=e.getComputedStyle(o,null).getPropertyValue(t)},d.init=function(e,t){var n=null;return n=void 0===t?d.getCss.call(this,e):d.setCss.call(this,e,t)};var f={};f.getAttr=function(e){return this.nodes.nodeName?this.nodes.getAttribute(e):this.nodes[0].getAttribute(e)},f.setAttr=function(e,t){if(this.nodes.nodeName)this.nodes.setAttribute(e,t);else for(var n=0;n<this.nodes.length;n++)this.nodes[n].setAttribute(e,t);return this},f.init=function(e,t){var n=null;return n=void 0===t?f.getAttr.call(this,e):f.setAttr.call(this,e,t)},o(n,{mix:o,get:i.get,ajax:i.ajax,jsonp:i.jsonp,route:c,on:u.on,live:u.live,module:h.init,component:h.component.init}),o(n.fn,l),o(n.fn,{on:u.on,live:u.live,ready:u.ready,css:d.init,attr:f.init}),e.$=e.Fishbone=n}(window,window.document);